import{d as y,i as A}from"./chunk-IRIKDAJS.js";import{Ba as P,Ea as l,Fb as O,Ja as f,Oa as h,Sa as _,Ub as E,Xb as I,ab as p,da as u,ea as g,eb as i,fb as n,gb as b,gc as D,ic as U,jc as F,kb as x,lc as k,mb as v,nb as d,nc as z,oc as T,sb as r,sc as N,tb as c,ub as C,uc as R,vb as S,wb as M,xb as w}from"./chunk-P2P3GMIO.js";function j(s,o){if(s&1&&(i(0,"div",9)(1,"p")(2,"strong"),r(3,"Bio:"),n(),r(4),n()()),s&2){let e=d();l(4),C(" ",(e.user==null?null:e.user.bio)||"No bio added yet","")}}function B(s,o){if(s&1&&(i(0,"div")(1,"p")(2,"strong"),r(3,"Preview:"),n()(),b(4,"img",16),n()),s&2){let e=d(2);l(4),p("src",e.previewUrl,P)}}function L(s,o){if(s&1){let e=x();i(0,"div",10)(1,"form",11),v("ngSubmit",function(){u(e);let a=d();return g(a.updateProfile())}),i(2,"label"),r(3," Bio: "),i(4,"textarea",12),w("ngModelChange",function(a){u(e);let m=d();return M(m.updateData.bio,a)||(m.updateData.bio=a),g(a)}),n()(),i(5,"label"),r(6," Profile Picture: "),i(7,"input",13),v("change",function(a){u(e);let m=d();return g(m.onFileSelected(a))}),n(),_(8,B,5,1,"div",14),n(),i(9,"button",15),r(10,"Save"),n()()()}if(s&2){let e=d();l(4),S("ngModel",e.updateData.bio),l(4),p("ngIf",e.previewUrl)}}var V=class s{constructor(o,e,t,a){this.profileService=o;this.route=e;this.cdRef=t;this.authservice=a}baseUrl="https://localhost:7038";user=null;defaultProfilePic="assets/images/";updateData={bio:"",profilePictureUrl:""};isEditing=!1;previewUrl=null;selectedFile=null;stats={followersCount:0,followingCount:0,postsCount:0};ngOnInit(){let o=this.authservice.getUsernameFromToken();this.profileService.getUserProfile(o).subscribe({next:e=>{console.log("ngOnInit of profile called",e),this.user=e,this.updateData.bio=e.bio,this.updateData.profilePictureUrl=e.profilePictureUrl,this.profileService.getProfileStats(e.id).subscribe({next:t=>{this.stats=t},error:t=>console.error("Failed to fetch stats",t)})}})}onFileSelected(o){let e=o.target;if(e.files&&e.files.length>0){this.selectedFile=e.files[0];let t=new FileReader;t.onload=()=>{this.previewUrl=t.result},t.readAsDataURL(this.selectedFile)}}updateProfile(){let o=new FormData;o.append("bio",this.updateData.bio),this.selectedFile&&o.append("profilePicture",this.selectedFile,this.selectedFile.name),o.forEach((e,t)=>{console.log(`${t}: ${e}`)}),this.profileService.updateProfile(o).subscribe({next:e=>{console.log(e),this.user&&(this.user.bio=this.updateData.bio,this.user.profilePictureUrl=`${this.baseUrl}/${e.profilePictureUrl}?t=${new Date().getTime()}`),this.cdRef.detectChanges(),this.isEditing=!1,this.previewUrl=""},error:e=>{console.error("Error updating profile:",e),alert("Failed to update profile.")}})}static \u0275fac=function(e){return new(e||s)(f(A),f(y),f(O),f(R))};static \u0275cmp=h({type:s,selectors:[["app-profile"]],decls:28,vars:9,consts:[[1,"profile-container"],[1,"profile-header"],["alt","Profile",1,"profile-pic",3,"src"],[1,"profile-info"],[1,"profile-stats"],[1,"stat"],[1,"edit-btn",3,"click"],["class","profile-details",4,"ngIf"],["class","profile-edit",4,"ngIf"],[1,"profile-details"],[1,"profile-edit"],[3,"ngSubmit"],["name","bio",3,"ngModelChange","ngModel"],["type","file","accept","image/*",3,"change"],[4,"ngIf"],["type","submit",1,"save-btn"],["alt","Profile Picture Preview",1,"profile-pic-preview",3,"src"]],template:function(e,t){if(e&1&&(i(0,"div",0)(1,"div",1),b(2,"img",2),i(3,"div",3)(4,"h2"),r(5),n(),i(6,"p"),r(7),n(),i(8,"div",4)(9,"div",5)(10,"strong"),r(11),n(),i(12,"div"),r(13,"Posts"),n()(),i(14,"div",5)(15,"strong"),r(16),n(),i(17,"div"),r(18,"Followers"),n()(),i(19,"div",5)(20,"strong"),r(21),n(),i(22,"div"),r(23,"Following"),n()()()(),i(24,"button",6),v("click",function(){return t.isEditing=!t.isEditing}),r(25),n()(),_(26,j,5,1,"div",7)(27,L,11,2,"div",8),n()),e&2){let a;l(2),p("src",(a=t.user==null?null:t.user.profilePictureUrl)!==null&&a!==void 0?a:t.defaultProfilePic,P),l(3),c(t.user==null?null:t.user.username),l(2),c(t.user==null?null:t.user.email),l(4),c(t.stats.postsCount),l(5),c(t.stats.followersCount),l(5),c(t.stats.followingCount),l(4),C(" ",t.isEditing?"Cancel":"Edit Profile"," "),l(),p("ngIf",!t.isEditing),l(),p("ngIf",t.isEditing)}},dependencies:[I,E,N,T,D,U,F,z,k],styles:[".profile-container[_ngcontent-%COMP%]{max-width:800px;margin:2rem auto;padding:2rem;border-radius:16px;box-shadow:0 10px 25px #00000014;background-color:#fff;font-family:Segoe UI,sans-serif;transition:all .3s ease-in-out}.profile-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:2rem;flex-wrap:wrap;margin-bottom:1.5rem}.profile-pic[_ngcontent-%COMP%]{width:120px;height:120px;border-radius:50%;object-fit:cover;border:3px solid #dbdbdb;background-color:#fafafa}.profile-info[_ngcontent-%COMP%]{flex:1}.profile-info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.8rem;color:#262626}.profile-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.3rem 0;color:#888}.profile-stats[_ngcontent-%COMP%]{display:flex;gap:2rem;margin-top:1rem}.stat[_ngcontent-%COMP%]{text-align:center}.stat[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:1.2rem;display:block;color:#262626}.stat[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{color:#888;font-size:.9rem}.edit-btn[_ngcontent-%COMP%]{background-color:#0095f6;color:#fff;border:none;padding:.6rem 1.2rem;border-radius:8px;font-size:.9rem;cursor:pointer;transition:background-color .3s ease}.edit-btn[_ngcontent-%COMP%]:hover{background-color:#007edb}.profile-details[_ngcontent-%COMP%]{margin-top:1.5rem;font-size:1rem;color:#333}.profile-edit[_ngcontent-%COMP%]{margin-top:1.5rem}.profile-edit[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:1rem;font-size:.95rem;color:#444}.profile-edit[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;min-height:80px;padding:.5rem;font-size:1rem;border:1px solid #ccc;border-radius:8px;resize:vertical}.profile-edit[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{display:block;margin-top:.5rem}.profile-pic-preview[_ngcontent-%COMP%]{margin-top:.8rem;max-width:150px;max-height:150px;border-radius:8px;object-fit:cover;border:2px solid #ddd}.save-btn[_ngcontent-%COMP%]{background-color:#262626;color:#fff;border:none;padding:.6rem 1.4rem;border-radius:8px;font-size:.95rem;cursor:pointer;margin-top:1rem;transition:background-color .3s ease}.save-btn[_ngcontent-%COMP%]:hover{background-color:#000}"]})};export{V as ProfileComponent};
